/*
   ods
   HOUSING V1
   LVL CLG MAJR GPA 
   W09MAR2022 \ 77j4d
   */


with a    as (select        spriden_pidm"pidm", spriden_id"pvamu_id", spriden_last_name"last_name", spriden_first_name"first_name", spriden_mi"mi_name"
              from          spriden@prod
              where         spriden_change_ind is null
              and           spriden_entity_ind='P'
              and           spriden_id
              in          ('P20915715',	'P21294261',	'P21336065',	'P21452013',	'P21495364',	'P21702753',	'P21726266',	'P21772816',	'P21880805',	'P21883220',	'P21891004',	'P22029457',	'P22075307',	'P22083210',	'P22085051',	'P22095999',	'P22122774',	'P22125665',	'P22138146',	'P22142017',	'P22163045',	'P22174847',	'P22183142',	'P22196274',	'P22196302',	'P22196519',	'P22197254',	'P22197289',	'P22199417',	'P22199690',	'P22200803',	'P22202406',	'P22203141',	'P22203169',	'P22203750',	'P22204842',	'P22205178',	'P22205297',	'P22205668',	'P22206214',	'P22206333',	'P22206466',	'P22206508',	'P22206564',	'P22206634',	'P22207096',	'P22207236',	'P22207558',	'P22207565',	'P22207600',	'P22208706',	'P22209014',	'P22209161',	'P22209378',	'P22210001',	'P22210232',	'P22210288',	'P22210456',	'P22211520',	'P22211751',	'P22211933',	'P22212801',	'P22212815',	'P22212997',	'P22213074',	'P22213102',	'P22213473',	'P22213823',	'P22213907',	'P22214859',	'P22214971',	'P22215468',	'P22215531',	'P22216609',	'P22218170',	'P22218254',	'P22218422',	'P22218450',	'P22218611',	'P22219010',	'P22219178',	'P22219591',	'P22219689',	'P22219857',	'P22219878',	'P22220032',	'P22220039',	'P22220550',	'P22220627',	'P22220676',	'P22221005',	'P22221460',	'P22221670',	'P22222069',	'P22223077',	'P22223133',	'P22229132',	'P22230602',	'P22230819',	'P22231288',	'P22231309',	'P22231379',	'P22231491',	'P22231596',	'P22232317',	'P22238540',	'P22241172',	'P22241333',	'P22241676',	'P22241774',	'P22242873',	'P22242887',	'P22242915',	'P22243531',	'P22244238',	'P22245015',	'P22245631',	'P22246387',	'P22246401',	'P22246695',	'P22246807',	'P22246821',	'P22247535',	'P22248389',	'P22250160',	'P22250524',	'P22251049',	'P22251105',	'P22251126',	'P22251371',	'P22252484',	'P22253289',	'P22253989',	'P22254017',	'P22254591',	'P22254766',	'P22254892',	'P22254962',	'P22254997',	'P22255179',	'P22256047',	'P22256054',	'P22256166',	'P22256677',	'P22257146',	'P22257160',	'P22258427',	'P22258455',	'P22258574',	'P22258707',	'P22259078',	'P22259323',	'P22259351',	'P22259533',	'P22259932',	'P22259981',	'P22260443',	'P22260583',	'P22261234',	'P22261311',	'P22261969',	'P22262130',	'P22262228',	'P22262599',	'P22262662',	'P22263250',	'P22263439',	'P22263460',	'P22263614',	'P22263635',	'P22264762',	'P22264860',	'P22264979',	'P22265007',	'P22265063',	'P22265448',	'P22265518',	'P22265658',	'P22266589',	'P22267058',	'P22267422',	'P22267695',	'P22267926',	'P22269326',	'P22269788',	'P22269914',	'P22270180',	'P22270670',	'P22271069',	'P22271202',	'P22271237',	'P22271272',	'P22271566',	'P22272497',	'P22272553',	'P22273127',	'P22273379',	'P22273470',	'P22273813',	'P22273848',	'P22274198',	'P22274611',	'P22274905',	'P22275339',	'P22275787',	'P22275941',	'P22276242',	'P22276389',	'P22276725',	'P22277019',	'P22277124',	'P22277593',	'P22277747',	'P22278111',	'P22278496',	'P22278545',	'P22278741',	'P22278986',	'P22279140',	'P22279224',	'P22279231',	'P22279497',	'P22279574',	'P22280029',	'P22280106',	'P22280295',	'P22280302',	'P22280498',	'P22280897',	'P22281310',	'P22281849',	'P22282248',	'P22282885',	'P22283305',	'P22283466',	'P22284845',	'P22285188',	'P22286707',	'P22287869',	'P22288583',	'P22288793',	'P22288891',	'P22289325',	'P22289661',	'P22289927',	'P22290074',	'P22290298',	'P22290515',	'P22290830',	'P22291033',	'P22291852',	'P22292720',	'P22294582',	'P22294694',	'P22294729',	'P22295310',	'P22295478',	'P22296626',	'P22296717',	'P22297739',	'P22298537',	'P22299041',	'P22299846',	'P22300434',	'P22300581',	'P22300721',	'P22301498',	'P22302702',	'P22302877',	'P22304242',	'P22304851',	'P22304872',	'P22305432',	'P22305978',	'P22306160',	'P22306237',	'P22306335',	'P22306531',	'P22307231',	'P22308050',	'P22309618',	'P22309863',	'P22310318',	'P22310780',	'P22311473',	'P22311550',	'P22312278',	'P22312425',	'P22313384',	'P22313706',	'P22314791',	'P22315946',	'P22316471',	'P22316730',	'P22317003',	'P22317206',	'P22317332',	'P22317416',	'P22317584',	'P22317626',	'P22318172',	'P22318242',	'P22318515',	'P22319110',	'P22319250',	'P22319656',	'P22319663',	'P22319684',	'P22319908',	'P22319929',	'P22320895',	'P22323037',	'P22323107',	'P22323352',	'P22323422',	'P22323569',	'P22323807',	'P22324192',	'P22325186',	'P22325207',	'P22325508',	'P22326166',	'P22326565',	'P22327244',	'P22327468',	'P22327510',	'P22327657',	'P22328119',	'P22328378',	'P22329288',	'P22329974',	'P22330009',	'P22330324',	'P22330352',	'P22330366',	'P22331136',	'P22331164',	'P22331913',	'P22332550',	'P22332760',	'P22333278',	'P22333383',	'P22333495',	'P22333537',	'P22333789',	'P22333796',	'P22333971',	'P22334097',	'P22334811',	'P22335812',	'P22336806',	'P22337891',	'P22338017',	'P22338234',	'P22338402',	'P22338647',	'P22338808',	'P22338906',	'P22338955',	'P22339235',	'P22339312',	'P22339487',	'P22339508',	'P22339767',	'P22339900',	'P22339921',	'P22340131',	'P22340271',	'P22341006',	'P22341125',	'P22341216',	'P22341384',	'P22341951',	'P22343197',	'P22343750',	'P22343757',	'P22345773',	'P22345836',	'P22346102',	'P22346158',	'P22346823',	'P22348993',	'P22350288',	'P22351457',	'P22352997',	'P22355146',	'P22356812',	'P22357484',	'P22358366',	'P22358583',	'P22359444',	'P22359542',	'P22360046',	'P22360284',	'P22360746',	'P22361593',	'P22361607',	'P22361768',	'P22362272',	'P22362881',	'P22363084',	'P22363203',	'P22365079',	'P22365716',	'P22365786',	'P22365982',	'P22369580',	'P22369818',	'P22370427',	'P22370525',	'P22370630',	'P22371267',	'P22373010',	'P22373213',	'P22373262',	'P22373332',	'P22373444',	'P22375327',	'P22378162',	'P22378512',	'P22378771',	'P22382383',	'P22387199',	'P22391434',	'P22393947',	'P22395781',	'P22395802',	'P22402116',	'P22403138',	'P22403915',	'P22406519',	'P22408234',	'P22408815',	'P22460265',	'P22460314',	'P22477093',	'P22478024',	'P22479312',	'P22480775',	'P22493970',	'P20774182',	'P21232192',	'P21302437',	'P21332187',	'P21425161',	'P21434821',	'P21491948',	'P21565070',	'P21574450',	'P21578671',	'P21587260',	'P21587953',	'P21591467',	'P21592300',	'P21627755',	'P21633439',	'P21642210',	'P21651296',	'P21661194',	'P21661565',	'P21675355',	'P21693135',	'P21712042',	'P21712651',	'P21724005',	'P21728905',	'P21729395',	'P21731348',	'P21731971',	'P21746342',	'P21747112',	'P21766285',	'P21782749',	'P21798723',	'P21799325',	'P21818841',	'P21829551',	'P21834339',	'P21842214',	'P21846813',	'P21859777',	'P21874330',	'P21880826',	'P21881911',	'P21883983',	'P21886720',	'P21893048',	'P21896394',	'P21903520',	'P21903982',	'P21907083',	'P21910338',	'P21910667',	'P21914818',	'P21916862',	'P21920992',	'P21922714',	'P21924625',	'P21934516',	'P21940060',	'P21944652',	'P21949097',	'P21950637',	'P21951855',	'P21954270',	'P21955600',	'P21956384',	'P21956440',	'P21962509',	'P21966072',	'P21970874',	'P21970909',	'P21971322',	'P21973044',	'P21974129',	'P21975669',	'P21979659',	'P21986379',	'P21989662',	'P21992784',	'P21996382',	'P22000057',	'P22004950',	'P22008527',	'P22009696',	'P22010676',	'P22010844',	'P22012146',	'P22012300',	'P22012594',	'P22013119',	'P22014148',	'P22014834',	'P22014897',	'P22016311',	'P22022205',	'P22022324',	'P22022366',	'P22022555',	'P22022849',	'P22023367',	'P22024550',	'P22024578',	'P22026692',	'P22026748',	'P22027525',	'P22031102',	'P22032866',	'P22033216',	'P22033741',	'P22034028',	'P22034539',	'P22034651',	'P22035169',	'P22035848',	'P22035967',	'P22037115',	'P22037255',	'P22037507',	'P22037899',	'P22037906',	'P22038704',	'P22038725',	'P22038872',	'P22041770',	'P22041917',	'P22042841',	'P22042869',	'P22042897',	'P22043009',	'P22043786',	'P22044094',	'P22044745',	'P22045074',	'P22045207',	'P22045389',	'P22045760',	'P22046642',	'P22046691',	'P22048000',	'P22048007',	'P22048175',	'P22048595',	'P22048819',	'P22048980',	'P22049414',	'P22049575',	'P22049687',	'P22050786',	'P22051066',	'P22051374',	'P22051584',	'P22051647',	'P22052879',	'P22053453',	'P22053621',	'P22053628',	'P22053768',	'P22053894',	'P22053971',	'P22054055',	'P22055189',	'P22055203',	'P22055210',	'P22055504',	'P22055770',	'P22056176',	'P22056904',	'P22057415',	'P22057429',	'P22057926',	'P22059417',	'P22059592',	'P22059774',	'P22059830',	'P22060397',	'P22061321',	'P22061552',	'P22062238',	'P22062245',	'P22062651',	'P22062770',	'P22064345',	'P22065416',	'P22065892',	'P22066431',	'P22067068',	'P22067572',	'P22068727',	'P22070029',	'P22072493',	'P22072549',	'P22073998',	'P22074551',	'P22074712',	'P22074810',	'P22075902',	'P22076119',	'P22077456',	'P22078072',	'P22078499',	'P22078632',	'P22078779',	'P22079290',	'P22079416',	'P22079780',	'P22079913',	'P22080018',	'P22080102',	'P22080361',	'P22081131',	'P22081894',	'P22082692',	'P22086808',	'P22087207',	'P22088733',	'P22088950',	'P22090756',	'P22092457',	'P22092513',	'P22093052',	'P22093759',	'P22093955',	'P22094340',	'P22094704',	'P22094977',	'P22096167',	'P22096636',	'P22096713',	'P22096832',	'P22096937',	'P22097392',	'P22099485',	'P22099814',	'P22100500',	'P22100633',	'P22100731',	'P22100934',	'P22101494',	'P22101942',	'P22102096',	'P22103503',	'P22103853',	'P22103888',	'P22107395',	'P22107479',	'P22107612',	'P22108130',	'P22108592',	'P22108725',	'P22108809',	'P22109439',	'P22110412',	'P22111210',	'P22111280',	'P22111896',	'P22112127',	'P22112141',	'P22112288',	'P22113674',	'P22114185',	'P22114745',	'P22115396',	'P22117132',	'P22117258',	'P22117832',	'P22117923',	'P22119652',	'P22119848',	'P22121234',	'P22121514',	'P22123131',	'P22123838',	'P22123978',	'P22124972',	'P22125105',	'P22126477',	'P22127373',	'P22127772',	'P22128332',	'P22128584',	'P22129382',	'P22129865',	'P22131027',	'P22132021',	'P22133155',	'P22133351',	'P22135031',	'P22135087',	'P22135311',	'P22138846',	'P22140155',	'P22140260',	'P22140918',	'P22141163',	'P22142570',	'P22142752',	'P22144894',	'P22146616',	'P22147848',	'P22149395',	'P22149577',	'P22149808',	'P22149913',	'P22150067',	'P22150515',	'P22150816',	'P22151110',	'P22151243',	'P22151523',	'P22152510',	'P22153798',	'P22154197',	'P22155296',	'P22156318',	'P22156815',	'P22157305',	'P22158600',	'P22159489',	'P22160791',	'P22161533',	'P22162674',	'P22163094',	'P22163115',	'P22164858',	'P22165411',	'P22165488',	'P22165782',	'P22165796',	'P22166279',	'P22166475',	'P22166482',	'P22166587',	'P22167385',	'P22168617',	'P22169744',	'P22171186',	'P22171606',	'P22174210',	'P22174630',	'P22175722',	'P22177598',	'P22180454',	'P22181126',	'P22181609',	'P22182484',	'P22182799',	'P22186257',	'P22187482',	'P22189463',	'P22193733',	'P22193964',	'P22196428',	'P22196792',	'P22197597',	'P22197674',	'P22198451',	'P22198766',	'P22199151',	'P22228019',	'P22228229',	'P22228572',	'P22232443',	'P22234487',	'P22234634',	'P22236944',	'P22237511',	'P22241116',	'P22241130',	'P22247290',	'P22249474',	'P22249936',	'P22266960',	'P22280624',	'P22301533',	'P22316303',	'P22321084',	'P22321497',	'P22323373',	'P22328455',	'P22333747',	'P22371589',	'P22375894',	'P22377567',	'P22379401',	'P22379604',	'P22380591',	'P22385365',	'P22388319',	'P22388921',	'P22389614',	'P22389740',	'P22389887',	'P22393436',	'P22396859',	'P22432097',	'P22460153',	'P22460860',	'P22480803',	'P22493949',	'P22499780',	'P22510175',	'P21081146',	'P21544973',	'P21592881',	'P21621315',	'P21630562',	'P21689397',	'P21732209',	'P21771752',	'P21800795',	'P21818281',	'P21825946',	'P21840380',	'P21859476',	'P21859994',	'P21871712',	'P21872804',	'P21881806',	'P21884046',	'P21903681',	'P21912480',	'P21916267',	'P21919683',	'P21969656',	'P21970125',	'P21988059',	'P22027399',	'P22070918',	'P22155975',	'P22319523',	'P22370672',	'P21109426',	'P21277825',	'P21376595',	'P21489596',	'P21524764',	'P21534284',	'P21576529',	'P21598306',	'P21605159',	'P21667438',	'P21669496',	'P21694283',	'P21708962',	'P21715913',	'P21718895',	'P21725769',	'P21728030',	'P21744179',	'P21751494',	'P21754581',	'P21756541',	'P21799171',	'P21801250',	'P21811232',	'P21820220',	'P21824609',	'P21832540',	'P21838042',	'P21840751',	'P21841206',	'P21843488',	'P21861457',	'P21861863',	'P21871838',	'P21880280',	'P21882814',	'P21890276',	'P21891865',	'P21911493',	'P21924702',	'P21926907',	'P21933480',	'P21940613',	'P21951827',	'P21964721',	'P21970923',	'P21971728',	'P21973471',	'P21985672',	'P21992763',	'P22002143',	'P22016206',	'P22039019',	'P22085597',	'P22088418',	'P22088425',	'P22152930',	'P22154596',	'P22172873',	'P22174308',	'P22185095',	'P22186754',	'P22197618',	'P22225485',	'P22232597',	'P22235684',	'P22249173',	'P22267289',	'P22345829',	'P22376762',	'P22380115',	'P22384910',	'P22386345',	'P22387395',	'P22390027',	'P22390580',	'P22474209',	'P20969146',	'P21056667',	'P21377134',	'P21435647',	'P21464788',	'P21488560',	'P21492795',	'P21493362',	'P21504933',	'P21514460',	'P21532198',	'P21555711',	'P21562235',	'P21563901',	'P21570586',	'P21570593',	'P21584425',	'P21632858',	'P21640131',	'P21641363',	'P21655846',	'P21656035',	'P21661005',	'P21661859',	'P21663441',	'P21669601',	'P21669678',	'P21672163',	'P21672457',	'P21675523',	'P21682243',	'P21688669',	'P21693275',	'P21701661',	'P21704111',	'P21718510',	'P21721289',	'P21722479',	'P21722556',	'P21731789',	'P21737746',	'P21740504',	'P21743465',	'P21749198',	'P21753342',	'P21754063',	'P21767090',	'P21767552',	'P21768266',	'P21780292')),

majr      as (select       "majr_pidm", "lvl", "clg", "majr"
        from (select        sgbstdn_pidm"majr_pidm", sgbstdn_levl_code"lvl", sgbstdn_coll_code_1"clg", sgbstdn_majr_code_1"majr", row_number()
        over (partition by  sgbstdn_pidm
              order by      sgbstdn_term_code_eff desc nulls last) rn
              from          sgbstdn@prod
              where         sgbstdn_pidm in(select "pidm" from a))
              where         rn=1),  

gpa       as (select        shrlgpa_pidm"gpa_pidm", shrlgpa_levl_code"gpa_lvl", to_char(shrlgpa_gpa,9.999)"pvamu_gpa"
              from          shrlgpa@prod
              where         shrlgpa_gpa_type_ind='I'
              and           shrlgpa_pidm in(select "pidm" from a))
              
      select               "pvamu_id", "last_name", "first_name", "mi_name",
                           "lvl", "clg", "majr",  
             (select        stvmajr_desc from stvmajr where stvmajr_code="majr") "major",
                           "pvamu_gpa"
      
        from  a 
        
   left join  majr      on "majr_pidm"="pidm" 
   
   left join  gpa       on "gpa_pidm"="pidm" ;        


/* sec 1.042 n 999 
--SELECT plan_table_output FROM TABLE(DBMS_XPLAN.DISPLAY());
--explain plan for
--  ner join (select       "xx


###
