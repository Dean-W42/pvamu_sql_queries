/*
   ods
   HOUSING V2
   LVL CLG MAJR GPA 
   W09MAR2022 \ 77j4d
   */


with a    as (select        spriden_pidm"pidm", spriden_id"pvamu_id", spriden_last_name"last_name", spriden_first_name"first_name", spriden_mi"mi_name"
              from          spriden@prod
              where         spriden_change_ind is null
              and           spriden_entity_ind='P'
              and           spriden_id
              in          ('P21798450',	'P21808110',	'P21809083',	'P21814963',	'P21815159',	'P21817756',	'P21818008',	'P21819289',	'P21819443',	'P21823727',	'P21832785',	'P21832995',	'P21833079',	'P21833912',	'P21839925',	'P21849270',	'P21852644',	'P21853946',	'P21866434',	'P21869325',	'P21871453',	'P21873861',	'P21874169',	'P21877382',	'P21879629',	'P21881981',	'P21882905',	'P21891452',	'P21892005',	'P21894189',	'P21894924',	'P21899439',	'P21899698',	'P21900384',	'P21900643',	'P21902939',	'P21906628',	'P21911948',	'P21913845',	'P21921034',	'P21921202',	'P21923701',	'P21931926',	'P21937274',	'P21944288',	'P21960591',	'P21960598',	'P21962334',	'P21962502',	'P21963279',	'P21964805',	'P21969005',	'P21972750',	'P21974164',	'P21974864',	'P21979708',	'P21983943',	'P21984062',	'P21984321',	'P21985987',	'P21996137',	'P21998559',	'P22009619',	'P22016024',	'P22023815',	'P22033069',	'P22036926',	'P22043674',	'P22061398',	'P22067565',	'P22105617',	'P22110629',	'P22122753',	'P22166426',	'P22200964',	'P22228005',	'P22241039',	'P22255564',	'P22284873',	'P22334531',	'P22380206',	'P22391994',	'P21392296',	'P21451894',	'P21495112',	'P21593861',	'P21635798',	'P21647789',	'P21648860',	'P21661327',	'P21679156',	'P21702886',	'P21720645',	'P21730648',	'P21800081',	'P21805618',	'P21812058',	'P21812191',	'P21816111',	'P21818603',	'P21833604',	'P21849522',	'P21863088',	'P21870830',	'P21872461',	'P21888897',	'P21889954',	'P21903758',	'P21931891',	'P21936434',	'P21943525',	'P21962691',	'P22015793',	'P22024361',	'P22029506',	'P22032089',	'P22036072',	'P22047027',	'P22056169',	'P22085716',	'P22121612',	'P22137929',	'P22161764',	'P22161981',	'P22183079',	'P22191283',	'P22381662',	'P21242496',	'P21648216',	'P21665884',	'P21675124',	'P21799346',	'P21875030',	'P21954914',	'P22046964',	'P22451368',	'P20668496',	'P21483884',	'P21575143',	'P21631395',	'P21675397',	'P21698343',	'P21840275',	'P21853981',	'P21875324',	'P21905844',	'P21966079',	'P21336121',	'P21378765',	'P21490240',	'P21494223',	'P21501496',	'P21545897',	'P21614273',	'P21627573',	'P21631962',	'P21642651',	'P21647082',	'P21647439',	'P21656490',	'P21683538',	'P21693261',	'P21693821',	'P21705938',	'P21719910',	'P21728261',	'P21734575',	'P21744928',	'P21751648',	'P21754462',	'P21755120',	'P21789084',	'P21799094',	'P21799990',	'P21801068',	'P21802545',	'P21810063',	'P21820710',	'P21829740',	'P21829915',	'P21846407',	'P21857642',	'P21864054',	'P21875191',	'P21880343',	'P21886657',	'P21889121',	'P21890423',	'P21893223',	'P21900615',	'P21910177',	'P21938422',	'P21967332',	'P21973051',	'P21981458',	'P21982018',	'P21985427',	'P21995976',	'P22031235',	'P22035862',	'P22040097',	'P22043933',	'P22046516',	'P22050877',	'P22054027',	'P22058584',	'P22064352',	'P22089797',	'P22092863',	'P22093332',	'P22097063',	'P22097294',	'P22098232',	'P22107689',	'P22125756',	'P22137467',	'P22139231',	'P22176114',	'P22194307',	'P22339403',	'P21616310',	'P21670364',	'P21817427',	'P21986337',	'P22010977',	'P22022898',	'P22057394',	'P22102131',	'P22106989',	'P22159349',	'P20928112',	'P20988970',	'P21482442',	'P21497919',	'P21584138',	'P21612229',	'P21626306',	'P21647271',	'P21673822',	'P21745411',	'P21796399',	'P21811134',	'P21912767',	'P22016430',	'P22035925',	'P22394920',	'P21528075',	'P21683629',	'P21669650',	'P21769015',	'P21837475',	'P21866889',	'P21875891',	'P21897080',	'P21899747',	'P22029016',	'P22035596',	'P22036471',	'P22039355',	'P22043919',	'P22046957',	'P22047055',	'P22049855',	'P22051108',	'P22051150',	'P22066319',	'P22070379',	'P22070834',	'P22071688',	'P22072514',	'P22073494',	'P22073627',	'P22074705',	'P22077204',	'P22077484',	'P22077890',	'P22081138',	'P22093528',	'P22095922',	'P22096251',	'P22097406',	'P22098036',	'P22104364',	'P22106541',	'P22109684',	'P22111357',	'P22112092',	'P22112925',	'P22115165',	'P22116369',	'P22118651',	'P22127779',	'P22130474',	'P22131979',	'P22135248',	'P22157459',	'P22159013',	'P22160819',	'P22161505',	'P22164179',	'P22164956',	'P22166468',	'P22170290',	'P22181917',	'P22183205',	'P22188560',	'P22188931',	'P22200733',	'P22208027',	'P22209385',	'P22209987',	'P22213718',	'P22215209',	'P22217981',	'P22221691',	'P22241767',	'P22241963',	'P22248592',	'P22250790',	'P22253142',	'P22253821',	'P22255046',	'P22255501',	'P22255725',	'P22256642',	'P22257958',	'P22258084',	'P22258105',	'P22264307',	'P22265532',	'P22265798',	'P22267464',	'P22271804',	'P22274968',	'P22278419',	'P22281163',	'P22283354',	'P22287274',	'P22290221',	'P22293658',	'P22299412',	'P22301855',	'P22312768',	'P22317619',	'P22332466',	'P22333740',	'P22354796',	'P22384000',	'P22384266',	'P22463030',	'P21331627',	'P21364758',	'P21448485',	'P21450207',	'P21452048',	'P21473223',	'P21481259',	'P21481294',	'P21484423',	'P21488777',	'P21489281',	'P21489428',	'P21491353',	'P21494496',	'P21505073',	'P21506508',	'P21539345',	'P21540640',	'P21560814',	'P21566547',	'P21570803',	'P21574233',	'P21596360',	'P21599244',	'P21604214',	'P21615911',	'P21623737',	'P21635280',	'P21642231',	'P21648419',	'P21648461',	'P21650897',	'P21656553',	'P21664939',	'P21667193',	'P21675439',	'P21677581',	'P21684413',	'P21686695',	'P21688403',	'P21692575',	'P21693030',	'P21693471',	'P21693513',	'P21696943',	'P21697944',	'P21702361',	'P21704300',	'P21707681',	'P21709837',	'P21711643',	'P21711993',	'P21713099',	'P21728422',	'P21731376',	'P21746335',	'P21747672',	'P21749527',	'P21750486',	'P21751935',	'P21755169',	'P21757094',	'P21760580',	'P21766047',	'P21766747',	'P21770793',	'P21780257',	'P21780733',	'P21780859',	'P21795202',	'P21811274',	'P21820143',	'P21820584',	'P21823104',	'P21836474',	'P21836768',	'P21845574',	'P21850670',	'P21854149',	'P21870221',	'P21882555',	'P21883654',	'P21883962',	'P21885404',	'P21889709',	'P21891102',	'P21896772',	'P21898368',	'P21899901',	'P21901056',	'P21908070',	'P21908182',	'P21928601',	'P21929441',	'P21929546',	'P21930428',	'P21933662',	'P21934628',	'P21940788',	'P21945338',	'P21952198',	'P21958988',	'P21962817',	'P21971441',	'P21972834',	'P21978924',	'P22018915',	'P22027161',	'P22027728',	'P22031669',	'P22041861',	'P22047755',	'P22052809',	'P22052984',	'P22059004',	'P22062301',	'P22073900',	'P22089237',	'P22090798',	'P22094781',	'P22114766',	'P22122879',	'P22227032',	'P22235579',	'P22244119',	'P22250412',	'P22297599',	'P22351807',	'P22359003',	'P22365611',	'P22398420',	'P22420757',	'P21499081',	'P21854975',	'P21962327',	'P21975172',	'P21538141',	'P21608169',	'P21616121',	'P21648608',	'P21658597',	'P21716046',	'P21725839',	'P21755568',	'P21759467',	'P21823279',	'P21864887',	'P21876213',	'P21934866',	'P22193460',	'P21386150',	'P21492788',	'P21667067',	'P21672177',	'P21675187',	'P21878418',	'P21882807',	'P21907377',	'P21939703',	'P22383230')),

majr      as (select       "majr_pidm", "lvl", "clg", "majr"
        from (select        sgbstdn_pidm"majr_pidm", sgbstdn_levl_code"lvl", sgbstdn_coll_code_1"clg", sgbstdn_majr_code_1"majr", row_number()
        over (partition by  sgbstdn_pidm
              order by      sgbstdn_term_code_eff desc nulls last) rn
              from          sgbstdn@prod
              where         sgbstdn_pidm in(select "pidm" from a))
              where         rn=1),  

gpa       as (select        shrlgpa_pidm"gpa_pidm", shrlgpa_levl_code"gpa_lvl", to_char(shrlgpa_gpa,9.999)"pvamu_gpa"
              from          shrlgpa@prod
              where         shrlgpa_gpa_type_ind='I'
              and           shrlgpa_pidm in(select "pidm" from a))
              
      select               "pvamu_id", "last_name", "first_name", "mi_name",
                           "lvl", "clg", "majr",  
             (select        stvmajr_desc from stvmajr where stvmajr_code="majr") "major",
                           "pvamu_gpa"
      
        from  a 
        
   left join  majr      on "majr_pidm"="pidm" 
   
   left join  gpa       on "gpa_pidm"="pidm" ;        


/* ms 554 n 515
--SELECT plan_table_output FROM TABLE(DBMS_XPLAN.DISPLAY());
--explain plan for
--  ner join (select       "xx


###
